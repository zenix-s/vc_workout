@page "/exercises"
@inject AppDbContext DbContext
@inject NavigationManager Navigation

<h3>Ejercicios</h3>

<div class="input-group mb-3">
    <input type="text" class="form-control" placeholder="Nuevo ejercicio" @bind="newExerciseName" />
    <button class="btn btn-primary" @onclick="AddExercise">Agregar</button>
</div>

@if (exercises == null)
{
    <p>Cargando...</p>
}
else
{
    <ul class="list-group">
        @foreach (var exercise in exercises)
        {
            <li class="list-group-item d-flex justify-content-between align-items-center" @onclick="() => NavigateToDetail(exercise.Id)" style="cursor: pointer;">
                @exercise.Name
                <span class="badge bg-primary rounded-pill">Ver</span>
            </li>
        }
    </ul>
}

@code {
    private List<Exercise>? exercises;
    private string newExerciseName = "";

    protected override async Task OnInitializedAsync()
    {
        await LoadExercises();
    }

    private async Task LoadExercises()
    {
        exercises = await DbContext.Exercises.ToListAsync();
    }

    private async Task AddExercise()
    {
        if (!string.IsNullOrWhiteSpace(newExerciseName))
        {
            DbContext.Exercises.Add(new Exercise { Name = newExerciseName });
            await DbContext.SaveChangesAsync();
            newExerciseName = "";
            await LoadExercises();
        }
    }

    private void NavigateToDetail(int id)
    {
        Navigation.NavigateTo($"/exercise/{id}");
    }
}
